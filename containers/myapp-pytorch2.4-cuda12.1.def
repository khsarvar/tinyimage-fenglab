Bootstrap: docker
From: pytorch/pytorch:2.4.0-cuda12.1-cudnn9-runtime

%labels
    org.opencontainers.image.title "myapp"
    org.opencontainers.image.description "PyTorch 2.4.0 + CUDA 12.1 + app deps"
    org.opencontainers.image.version "1.0"

%environment
    export PYTHONUNBUFFERED=1
    export PIP_NO_CACHE_DIR=1
    export MPLBACKEND=Agg   # headless plotting

%files
    containers/requirements.txt /opt/requirements.txt

%post
    set -eux
    pip install --upgrade pip wheel
    pip install --no-cache-dir -r /opt/requirements.txt
    rm -f /opt/requirements.txt

%runscript
    # Allows: apptainer run image.sif train_tinynet.py --args
    exec python "$@"
